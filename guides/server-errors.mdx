---
title: 'Ошибки сервера и DDoS защита'
description: 'Что делать если сервер возвращает ошибки во время защиты от атак'
icon: 'shield-halved'
---

## Защита от DDoS атак

Love&Pay использует многоуровневую систему защиты от DDoS атак. В редких случаях, когда наша инфраструктура подвергается атаке, система автоматически подключает дополнительные шлюзы для фильтрации вредоносного трафика.

<Info>
  Во время подключения защитных шлюзов возможны кратковременные перебои в работе API. Обычно это занимает от нескольких секунд до нескольких минут.
</Info>

## Коды ошибок при DDoS защите

В момент активации защиты или во время атаки вы можете получить следующие ответы от сервера:

| Код | Ошибка | Описание |
|-----|--------|----------|
| **503** | Service Unavailable | Сервер временно не может обрабатывать запросы из-за перегрузки или подключения защитных шлюзов |
| **502** | Bad Gateway | Сервер-шлюз не получил ответа от основного сервера |
| **504** | Gateway Timeout | Превышено время ожидания ответа от сервера |
| **500** | Internal Server Error | Сервер столкнулся с непредвиденной ситуацией |
| **429** | Too Many Requests | Слишком много запросов — возможно, ваш IP попал под фильтрацию |
| **408** | Request Timeout | Превышено время ожидания запроса |

## Что делать при получении ошибок?

<Steps>
  <Step title="Не паникуйте">
    Кратковременные ошибки во время DDoS защиты — это нормально. Система автоматически восстановится.
  </Step>
  <Step title="Подождите и повторите">
    Подождите 30-60 секунд и повторите запрос. В большинстве случаев сервис восстанавливается быстро.
  </Step>
  <Step title="Реализуйте retry-логику">
    Ваш код должен автоматически повторять запросы при получении ошибок 5xx.
  </Step>
  <Step title="Проверьте статус">
    Следите за нашими каналами связи для информации о текущих инцидентах.
  </Step>
</Steps>

## Рекомендации по обработке ошибок

### Exponential Backoff

При получении ошибок 5xx рекомендуем использовать стратегию exponential backoff:

```javascript
async function requestWithRetry(url, options, maxRetries = 5) {
  for (let attempt = 0; attempt < maxRetries; attempt++) {
    try {
      const response = await fetch(url, options);

      // Если ошибка 5xx — повторяем
      if (response.status >= 500) {
        throw new Error(`Server error: ${response.status}`);
      }

      return response;
    } catch (error) {
      // Ждём перед повтором: 1с, 2с, 4с, 8с, 16с
      const delay = Math.pow(2, attempt) * 1000;
      console.log(`Попытка ${attempt + 1} неудачна. Повтор через ${delay}мс...`);
      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }

  throw new Error('Превышено количество попыток');
}
```

### Обработка в вашем приложении

<CardGroup cols={2}>
  <Card title="Показывайте понятные сообщения" icon="message">
    Не показывайте пользователям технические ошибки. Сообщите что сервис временно недоступен.
  </Card>
  <Card title="Сохраняйте данные локально" icon="floppy-disk">
    При создании счетов сохраняйте данные локально и отправляйте повторно при восстановлении связи.
  </Card>
  <Card title="Используйте очереди" icon="list-check">
    Для критичных операций используйте очереди сообщений (Redis, RabbitMQ).
  </Card>
  <Card title="Логируйте ошибки" icon="file-lines">
    Записывайте все ошибки для последующего анализа и отладки.
  </Card>
</CardGroup>

## Как понять что идёт атака?

<Warning>
  Если вы получаете множественные ошибки 503/502/504 в течение нескольких минут — скорее всего, идёт DDoS атака и система активирует защиту.
</Warning>

Признаки активной защиты от DDoS:

- Периодические ошибки 503 Service Unavailable
- Увеличенное время ответа API
- Временные таймауты при запросах
- Ошибки 502/504 от прокси-серверов

## Связь с поддержкой

Если ошибки продолжаются более 15 минут:

<Card title="Напишите в онлайн-чат" icon="comments" href="https://loveandpay.io">
  Наша команда мониторит все инциденты и оперативно информирует о статусе восстановления. Напишите нам на **loveandpay.io** если у вас срочный вопрос.
</Card>

<Info>
  Мы прилагаем все усилия чтобы минимизировать влияние атак на работу сервиса. Спасибо за понимание!
</Info>
