---
title: 'Введение в API v2'
description: 'Love&Pay API v2 с усиленной безопасностью'
---

<Warning>
**API v1 будет отключён 25.01.2026!**

Пожалуйста, мигрируйте на API v2 до этой даты. API v1 перестанет работать и все запросы будут возвращать ошибку.
</Warning>

## Что нового в API v2

API v2 включает значительные улучшения безопасности и новые возможности:

<CardGroup cols={2}>
  <Card title="HMAC-SHA256 подпись" icon="shield-check">
    Все запросы подписываются криптографической подписью
  </Card>
  <Card title="Rate Limiting" icon="gauge">
    Защита от перегрузки с детальными заголовками
  </Card>
  <Card title="Защита от циклов" icon="rotate">
    Автоматическая блокировка повторяющихся запросов
  </Card>
  <Card title="Batch операции" icon="layer-group">
    Массовое создание счетов из CSV/JSON
  </Card>
</CardGroup>

## Базовый URL

```
https://loveandpay.io/api/v2
```

## Ключевые отличия от v1

| Функция | API v1 | API v2 |
|---------|--------|--------|
| Аутентификация | Только `x-api-key` | HMAC-SHA256 подпись |
| Timestamp | Не требуется | В миллисекундах |
| Rate Limiting | Нет | 100/мин, 1000/час |
| Защита от циклов | Нет | Есть |
| Batch операции | Нет | Есть |
| Управление клиентами | Ограничено | Полное |
| Чеки (anti-fraud) | Нет | Есть |

## Обязательные заголовки

Каждый запрос к API v2 должен содержать:

| Заголовок | Описание |
|-----------|----------|
| `x-api-key` | Ваш API ключ партнёра |
| `x-timestamp` | Unix timestamp в миллисекундах |
| `x-signature` | HMAC-SHA256 подпись запроса |

## Быстрый старт

### 1. Получите ключи API

Перейдите в [Панель управления](https://loveandpay.io/dashboard) → Настройки API и сгенерируйте новый секретный ключ для API v2.

### 2. Установите SDK (опционально)

```bash
npm install @loveandpay/sdk
```

### 3. Сделайте первый запрос

```javascript
const crypto = require('crypto');

const API_KEY = 'pk_live_xxx';
const SECRET_KEY = 'sk_live_xxx';

function generateSignature(method, path, timestamp, body = '') {
  const bodyHash = crypto.createHash('sha256').update(body).digest('hex');
  const message = `${method.toUpperCase()}${path}${timestamp}${bodyHash}`;
  return crypto.createHmac('sha256', SECRET_KEY).update(message).digest('hex');
}

const timestamp = Date.now().toString();
const method = 'POST';
const path = '/api/v2/invoices';
const body = JSON.stringify({ amount: 1000, description: 'Тестовый счёт' });

const response = await fetch('https://loveandpay.io' + path, {
  method,
  headers: {
    'Content-Type': 'application/json',
    'x-api-key': API_KEY,
    'x-timestamp': timestamp,
    'x-signature': generateSignature(method, path, timestamp, body)
  },
  body
});

console.log(await response.json());
```

## Миграция с v1

<Steps>
  <Step title="Сгенерируйте секретный ключ">
    В личном кабинете сгенерируйте новый секретный ключ для HMAC подписи
  </Step>
  <Step title="Обновите код аутентификации">
    Добавьте генерацию HMAC подписи в каждый запрос
  </Step>
  <Step title="Обновите URL">
    Замените `/api/v1/` на `/api/v2/` во всех эндпоинтах
  </Step>
  <Step title="Протестируйте">
    Проверьте работу всех эндпоинтов на тестовых данных
  </Step>
</Steps>

<Note>
При возникновении вопросов по миграции обращайтесь в поддержку: [support@loveandpay.io](mailto:support@loveandpay.io)
</Note>

---

## Следующие шаги

<CardGroup cols={2}>
  <Card title="Аутентификация" icon="key" href="/api-reference/v2/authentication">
    Подробно о HMAC подписи
  </Card>
  <Card title="Rate Limiting" icon="gauge" href="/api-reference/v2/rate-limiting">
    Лимиты и защита
  </Card>
  <Card title="Создание счёта" icon="file-invoice-dollar" href="/api-reference/v2/invoices/create">
    Первый API запрос
  </Card>
  <Card title="Коды ошибок" icon="triangle-exclamation" href="/api-reference/v2/errors">
    Обработка ошибок
  </Card>
</CardGroup>
