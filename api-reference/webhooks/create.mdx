---
title: 'Создание вебхука'
description: 'Регистрация URL для получения уведомлений о событиях'
api: 'POST https://loveandpay.io/api/v1/webhooks'
---

## Создание вебхука

Регистрирует URL-адрес для получения уведомлений о событиях в вашем аккаунте.

### Аутентификация

<ParamField header="x-api-key" type="string" required>
  Ваш API ключ
</ParamField>

### Параметры запроса

<ParamField body="url" type="string" required>
  URL для отправки уведомлений. Должен быть HTTPS.
</ParamField>

<ParamField body="events" type="array" required>
  Массив событий для подписки. Доступные события:
  - `invoice.created` - счёт создан
  - `invoice.paid` - счёт оплачен
  - `invoice.expired` - счёт истёк
  - `invoice.cancelled` - счёт отменён
  - `kyc.completed` - KYC верификация завершена
  - `kyc.failed` - KYC верификация не пройдена
</ParamField>

<ParamField body="secret" type="string">
  Секретный ключ для подписи вебхуков. Если не указан, будет сгенерирован автоматически.
</ParamField>

### Пример запроса

<CodeGroup>

```bash cURL
curl -X POST "https://loveandpay.io/api/v1/webhooks" \
  -H "x-api-key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://yoursite.com/webhooks/loveandpay",
    "events": ["invoice.paid", "invoice.expired"]
  }'
```

```javascript Node.js
const response = await fetch('https://loveandpay.io/api/v1/webhooks', {
  method: 'POST',
  headers: {
    'x-api-key': process.env.LOVEANDPAY_API_KEY,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    url: 'https://yoursite.com/webhooks/loveandpay',
    events: ['invoice.paid', 'invoice.expired']
  })
});

const webhook = await response.json();
console.log(webhook.secret); // Сохраните этот секрет!
```

```python Python
import requests

response = requests.post(
    'https://loveandpay.io/api/v1/webhooks',
    headers={
        'x-api-key': 'YOUR_API_KEY',
        'Content-Type': 'application/json'
    },
    json={
        'url': 'https://yoursite.com/webhooks/loveandpay',
        'events': ['invoice.paid', 'invoice.expired']
    }
)

webhook = response.json()
print(webhook['secret'])  # Сохраните этот секрет!
```

</CodeGroup>

### Пример ответа

<ResponseField name="id" type="string">
  Уникальный идентификатор вебхука
</ResponseField>

<ResponseField name="url" type="string">
  URL для уведомлений
</ResponseField>

<ResponseField name="events" type="array">
  Список событий для подписки
</ResponseField>

<ResponseField name="secret" type="string">
  Секретный ключ для верификации подписи. **Показывается только один раз!**
</ResponseField>

<ResponseField name="active" type="boolean">
  Статус активности вебхука
</ResponseField>

<ResponseField name="createdAt" type="string">
  Дата создания
</ResponseField>

```json Успешный ответ (201)
{
  "id": "wh_abc123def456",
  "url": "https://yoursite.com/webhooks/loveandpay",
  "events": ["invoice.paid", "invoice.expired"],
  "secret": "whsec_a1b2c3d4e5f6g7h8i9j0...",
  "active": true,
  "createdAt": "2024-01-15T10:30:00Z"
}
```

<Warning>
  Секретный ключ (`secret`) показывается только при создании вебхука. Обязательно сохраните его в безопасном месте для верификации входящих уведомлений.
</Warning>

### Управление вебхуками

После создания вы можете управлять вебхуками через панель управления или API:

- **GET /webhooks** - список всех вебхуков
- **GET /webhooks/{id}** - получить вебхук по ID
- **PATCH /webhooks/{id}** - обновить вебхук
- **DELETE /webhooks/{id}** - удалить вебхук

### Ошибки

| Код | Описание |
|-----|----------|
| 400 | Неверные параметры (URL не HTTPS, неизвестные события) |
| 401 | Неверный API ключ |
| 409 | Вебхук с таким URL уже существует |
| 422 | Валидация не пройдена |
